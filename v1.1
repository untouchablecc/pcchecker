import logging
import os
import sys

# Set up logging
def setup_logging():
    try:
        log_file_path = os.path.join(os.getenv('APPDATA'), 'MyPythonScript', 'scan_log.txt')
        os.makedirs(os.path.dirname(log_file_path), exist_ok=True)
        logging.basicConfig(
            filename=log_file_path,
            level=logging.DEBUG,
            format='%(asctime)s - %(levelname)s - %(message)s'
        )
        logging.info("Logging setup complete.")
    except Exception as e:
        print(f"Failed to set up logging: {e}", file=sys.stderr)
        sys.exit(1)

# Scan directories for traces
def scan_directories(base_dir, trace_keywords):
    try:
        logging.info(f"Scanning directory: {base_dir}")
        found_any_trace = False
        for root, dirs, files in os.walk(base_dir):
            for file_name in files:
                file_path = os.path.join(root, file_name)
                for keyword in trace_keywords:
                    if keyword.lower() in file_name.lower():
                        logging.info(f"Found trace: {file_path}")
                        found_any_trace = True
        if not found_any_trace:
            logging.info(f"No traces found in directory: {base_dir}")
    except Exception as e:
        logging.error(f"Error scanning directory {base_dir}: {e}")

# Main function
def main():
    setup_logging()

    # Define the directories to scan and the keywords to look for
    directories_to_scan = [
        'C:\\',  # Root of the C drive
        os.path.join(os.getenv('APPDATA'), 'Local'),
        os.path.join(os.getenv('APPDATA'), 'LocalLow'),
        os.path.join(os.getenv('APPDATA'), 'Roaming')
    ]
    trace_keywords = [
        'steam',
        'Spotify',
        'RazerCortex',
        'Razer Synapse 3',
        'lghub',
        'chrome',
        'TikTok LIVE Studio',
        'voicemeeterpro',
        'brave'
    ]

    for directory in directories_to_scan:
        scan_directories(directory, trace_keywords)

    logging.info("Scan complete.")

if __name__ == "__main__":
    main()
